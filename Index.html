<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Game</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    .answer-btn {
      width: 100%;
      height: 80px;
      font-size: 6vw;
    }
    .question {
      font-size: 8vw;
      margin-bottom: 1rem;
    }
    .timer, .score {
      font-size: 5vw;
      margin-top: 0.5rem;
    }
    @media (max-width: 768px) {
      .answer-btn { font-size: 8vw; }
      .question { font-size: 10vw; }
      .timer, .score { font-size: 7vw; }
    }
  </style>
</head>
<body class="section">

  <!-- Landing Page -->
  <div id="landingPage" class="container has-text-centered">
    <h1 class="title is-3">Welcome to Math Game</h1>

    <div class="field">
      <label class="label">Min Number</label>
      <div class="control">
        <input id="minNumber" class="input" type="number" value="1">
      </div>
    </div>

    <div class="field">
      <label class="label">Max Number</label>
      <div class="control">
        <input id="maxNumber" class="input" type="number" value="9">
      </div>
    </div>

    <div class="field">
      <label class="label">Game Duration (minutes)</label>
      <div class="control">
        <input id="gameTime" class="input" type="number" value="1">
      </div>
    </div>

    <div class="field">
      <label class="label">Question Timer (seconds)</label>
      <div class="control">
        <input id="questionTime" class="input" type="number" value="5">
      </div>
    </div>

    <button class="button is-primary is-large mt-4" onclick="startGame()">Start Game</button>
  </div>

  <!-- Game Page -->
  <div id="gamePage" class="container has-text-centered is-hidden">
    <div id="timer" class="timer"></div>
    <div id="questionTimer" class="timer"></div>
    <div id="score" class="score"></div>
    <div id="question" class="question"></div>

    <div class="columns is-multiline">
      <div class="column is-half">
        <button id="btn0" class="button is-info answer-btn" onclick="checkAnswer(0)"></button>
      </div>
      <div class="column is-half">
        <button id="btn1" class="button is-info answer-btn" onclick="checkAnswer(1)"></button>
      </div>
      <div class="column is-half">
        <button id="btn2" class="button is-info answer-btn" onclick="checkAnswer(2)"></button>
      </div>
      <div class="column is-half">
        <button id="btn3" class="button is-info answer-btn" onclick="checkAnswer(3)"></button>
      </div>
    </div>
  </div>

  <script>
    let minNumber, maxNumber, gameDuration, questionDuration;
    let score = 0, total = 0;
    let correctAnswer, gameTimer, questionTimer;
    let gameOver = false;

    function startGame() {
      minNumber = parseInt(document.getElementById('minNumber').value) || 1;
      maxNumber = parseInt(document.getElementById('maxNumber').value) || 9;
      gameDuration = parseInt(document.getElementById('gameTime').value) * 60 || 60;
      questionDuration = parseInt(document.getElementById('questionTime').value) || 5;

      score = 0; total = 0; gameOver = false;

      document.getElementById('landingPage').classList.add('is-hidden');
      document.getElementById('gamePage').classList.remove('is-hidden');

      document.getElementById('score').innerText = `Score: 0/0`;

      startGameTimer();
      nextQuestion();
    }

    function startGameTimer() {
      let timeLeft = gameDuration;
      document.getElementById('timer').innerText = `Time Left: ${timeLeft}s`;
      gameTimer = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').innerText = `Time Left: ${timeLeft}s`;
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    function startQuestionTimer() {
      let qTime = questionDuration;
      document.getElementById('questionTimer').innerText = `Question Time: ${qTime}s`;
      questionTimer = setInterval(() => {
        if (gameOver) return;
        qTime--;
        document.getElementById('questionTimer').innerText = `Question Time: ${qTime}s`;
        if (qTime <= 0) {
          clearInterval(questionTimer);
          markUnanswered();
        }
      }, 1000);
    }

    function nextQuestion() {
      if (gameOver) return;
      clearInterval(questionTimer);

      const num1 = Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;
      const num2 = Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;
      const isAddition = Math.random() < 0.5;

      let displayFormat = Math.floor(Math.random() * 3);
      let questionText = "";
      if (isAddition) {
        correctAnswer = num1 + num2;
        if (displayFormat === 0) questionText = `${num1} + ? = ${correctAnswer}`;
        else if (displayFormat === 1) questionText = `? + ${num2} = ${correctAnswer}`;
        else questionText = `${num1} + ${num2} = ?`;
      } else {
        let a = Math.max(num1, num2), b = Math.min(num1, num2);
        correctAnswer = a - b;
        if (displayFormat === 0) questionText = `${a} - ? = ${correctAnswer}`;
        else if (displayFormat === 1) questionText = `? - ${b} = ${correctAnswer}`;
        else questionText = `${a} - ${b} = ?`;
      }

      document.getElementById('question').innerText = questionText;

      let answers = [correctAnswer];
      while (answers.length < 4) {
        let wrong = correctAnswer + Math.floor(Math.random() * 10) - 5;
        if (wrong >= minNumber && wrong <= maxNumber * 2 && !answers.includes(wrong)) {
          answers.push(wrong);
        }
      }
      answers.sort(() => Math.random() - 0.5);

      answers.forEach((ans, i) => {
        let btn = document.getElementById(`btn${i}`);
        btn.innerText = ans;
        btn.className = "button is-light answer-btn";
        btn.disabled = false;
      });

      startQuestionTimer();
    }

    function checkAnswer(i) {
      if (gameOver) return;
      clearInterval(questionTimer);
      total++;
      const btn = document.getElementById(`btn${i}`);
      if (parseInt(btn.innerText) === correctAnswer) {
        score++;
        btn.classList.add("is-success");
        document.body.style.backgroundColor = "#d4edda";
      } else {
        btn.classList.add("is-danger");
        document.body.style.backgroundColor = "#f8d7da";
        for (let j = 0; j < 4; j++) {
          if (parseInt(document.getElementById(`btn${j}`).innerText) === correctAnswer) {
            document.getElementById(`btn${j}`).classList.add("is-success");
          }
        }
      }
      document.getElementById('score').innerText = `Score: ${score}/${total}`;
      setTimeout(() => {
        document.body.style.backgroundColor = "";
        nextQuestion();
      }, 1000);
    }

    function markUnanswered() {
      total++;
      document.body.style.backgroundColor = "#f8d7da";
      for (let j = 0; j < 4; j++) {
        if (parseInt(document.getElementById(`btn${j}`).innerText) === correctAnswer) {
          document.getElementById(`btn${j}`).classList.add("is-success");
        }
      }
      document.getElementById('score').innerText = `Score: ${score}/${total}`;
      setTimeout(() => {
        document.body.style.backgroundColor = "";
        nextQuestion();
      }, 1000);
    }

    function endGame() {
      gameOver = true;
      clearInterval(gameTimer);
      clearInterval(questionTimer);
      document.getElementById('question').innerText = "Game Over!";
      for (let i = 0; i < 4; i++) {
        document.getElementById(`btn${i}`).disabled = true;
      }
    }
  </script>
</body>
  </html>
